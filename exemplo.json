#!/bin/bash

# Pedir ao usuário um nome para criar um diretório
echo "Digite um nome para o diretório:"
read nome_diretorio

# Criar o diretório
mkdir "$nome_diretorio"

# Copiar conteúdo do JSON Star Wars para o diretório
curl -o https://swapi.dev/api/people > "$nome_diretorio/dados_star_wars.json"

# Requisitar ao usuário um termo para ser buscado no arquivo JSON
echo "Digite um termo para buscar no arquivo JSON:"
read termo_busca

# Extrair as linhas que possuem o valor digitado e colocar o resultado em "output.txt"
grep -i "$termo_busca" "$nome_diretorio/dados_star_wars.json" > "$nome_diretorio/output.txt"

# Perguntar ao usuário de qual seção (objeto) ele precisa da informação
echo "Digite a seção (objeto) que deseja buscar no arquivo JSON:"
read secao_busca

# Extrair a informação da seção buscada usando jq e gravar no final de "output.txt"
jq ".$secao_busca" "$nome_diretorio/dados_star_wars.json" >> "$nome_diretorio/output.txt"

# Perguntar ao usuário qual valor isolado desta seção ele gostaria de ver
echo "Digite o valor isolado que gostaria de ver:"
read valor_isolado

# Exibir o valor na tela
echo "Valor isolado: $valor_isolado"

# Criar um novo arquivo JSON com a seção totalmente alterada
novo_arquivo_json="$nome_diretorio/novo_arquivo.json"
cp "$nome_diretorio/dados_star_wars.json" "$novo_arquivo_json"
jq ".$secao_busca = \"$valor_isolado\"" "$novo_arquivo_json" > tmpfile && mv tmpfile "$novo_arquivo_json"

# Criar 5 cópias do novo arquivo
for i in {1..5}
do
  cp "$novo_arquivo_json" "$nome_diretorio/copia_$i.json"
done

echo "Operações concluídas com sucesso!"
